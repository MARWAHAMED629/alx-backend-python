#!/bin/bash

echo "ğŸ”§ Kubernetes Cluster Setup Script"

# ğŸ” Check if Minikube and kubectl are installed
if [ -z "$(command -v minikube)" ] || [ -z "$(command -v kubectl)" ]; then
    echo "âŒ Minikube or kubectl is not installed. Please install them first."
    exit 1
fi

echo "âœ… Minikube and kubectl are installed."

# ğŸš€ Check if Minikube cluster is already running
if minikube status | grep -q "Running"; then
    echo "âœ… Minikube cluster is already running."
else
    echo "ğŸ”„ Starting Minikube cluster..."
    minikube start
    if [ $? -ne 0 ]; then
        echo "âŒ Failed to start Minikube. Please check your installation."
        exit 1
    fi
    echo "âœ… Minikube started successfully."
fi

# ğŸ“¡ Verify cluster access
echo ""
echo "ğŸ”¹ STEP: Verifying cluster with kubectl cluster-info"
kubectl cluster-info

if [ $? -eq 0 ]; then
    echo "âœ… Cluster is running and accessible."
else
    echo "âŒ Failed to connect to the cluster."
    exit 1
fi

# ğŸ“¦ Get pods across all namespaces
echo ""
echo "ğŸ”¹ STEP: Retrieving available pods"
kubectl get pods --all-namespaces

echo ""
echo "âœ… Script completed successfully!"
